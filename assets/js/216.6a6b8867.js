(window.webpackJsonp=window.webpackJsonp||[]).push([[216],{641:function(s,a,t){"use strict";t.r(a);var n=t(25),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"多卡-gpu-速度太慢问题排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多卡-gpu-速度太慢问题排查"}},[s._v("#")]),s._v(" 多卡 GPU 速度太慢问题排查")]),s._v(" "),t("h4",{attrs:{id:"_1、根据参考资料-1-查看-gpu-之间的通信方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、根据参考资料-1-查看-gpu-之间的通信方式"}},[s._v("#")]),s._v(" 1、根据参考资料 [1] 查看 GPU 之间的通信方式")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nvidia-smi topo --matrix\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("\tGPU0\tGPU1\tCPU Affinity\tNUMA Affinity\nGPU0\t X \tNODE\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-15,32-47\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nGPU1\tNODE\t X \t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-15,32-47\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nLegend:\n\n  X    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Self\n  SYS  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing PCIe as well as the SMP interconnect between NUMA nodes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g., QPI/UPI"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  NODE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node\n  PHB  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing PCIe as well as a PCIe Host Bridge "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("typically the CPU"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  PXB  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing multiple PCIe bridges "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("without traversing the PCIe Host Bridge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  PIX  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing at "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("most")]),s._v(" a single PCIe bridge\n  NV"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  = Connection traversing a bonded set of # NVLinks")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("在双卡 RTX TITAN 的工作站上看到 GPU0 和 GPU1 是通过 NODE 方式通信的")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("GPU0\tGPU1\tGPU2\tGPU3\tCPU Affinity\tNUMA Affinity\nGPU0\t X \tPIX\tSYS\tSYS\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-19\t\tN/A\nGPU1\tPIX\t X \tSYS\tSYS\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-19\t\tN/A\nGPU2\tSYS\tSYS\t X \tPIX\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-19\t\tN/A\nGPU3\tSYS\tSYS\tPIX\t X \t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-19\t\tN/A\n \nLegend:\n \n  X    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Self\n  SYS  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing PCIe as well as the SMP interconnect between NUMA nodes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e.g., QPI/UPI"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  NODE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node\n  PHB  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing PCIe as well as a PCIe Host Bridge "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("typically the CPU"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  PXB  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing multiple PCIe bridges "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("without traversing the PCIe Host Bridge"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  PIX  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection traversing at "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("most")]),s._v(" a single PCIe bridge\n  NV"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  = Connection traversing a bonded set of # NVLinks ")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("在四卡 RTX 2080Ti 的服务器上是上述输出，")]),s._v(" "),t("ul",[t("li",[s._v("GPU0 与 GPU1 是 PIX 通信方式，")]),s._v(" "),t("li",[s._v("GPU2 与 GPU3 是 PIX 通信方式")]),s._v(" "),t("li",[s._v("GPU0 与 GPU2、GPU3 是 SYS 通信方式")]),s._v(" "),t("li",[s._v("GPU1 与 GPU2、GPU3 是 SYS 通信方式")])]),s._v(" "),t("h4",{attrs:{id:"_2、测试通信带宽"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、测试通信带宽"}},[s._v("#")]),s._v(" 2、测试通信带宽")]),s._v(" "),t("p",[s._v("使用 CUDA Samples 提供的 P2P 带宽测试脚本")]),s._v(" "),t("ul",[t("li",[s._v("https://github.com/NVIDIA/cuda-samples/tree/master/Samples/p2pBandwidthLatencyTest")])]),s._v(" "),t("p",[s._v("测试方法：")]),s._v(" "),t("ul",[t("li",[s._v("在 "),t("code",[s._v("https://github.com/NVIDIA/cuda-samples/releases")]),s._v(" 中找到对应 CUDA 版本的 CUDA Samples")]),s._v(" "),t("li",[t("code",[s._v("nvcc -V")]),s._v(" 查看 CUDA 版本")]),s._v(" "),t("li",[s._v("例如我本地是CUDA-10.2 ，然后 Download 以及 unzip，随后按照下面的命令编译并运行")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" cuda-samples-10.2/Samples/p2pBandwidthLatencyTest\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./p2pBandwidthLatencyTest\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Bidirectional "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("P2P")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Enabled Bandwidth Matrix "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GB/s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   D"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("D     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("556.92")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.65")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.58")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("457.95")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Bidirectional "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("P2P")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Enabled Bandwidth Matrix "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GB/s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   DD     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("526.19")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.27")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.05")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.41")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.37")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("527.06")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.12")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.53")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.47")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.67")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("526.39")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.80")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.30")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.93")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("436.79")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("GPU 之间的通信带宽属实有点低，尝试通过安装 nvlink 来解决")]),s._v(" "),t("p",[s._v("------------2021/09/19更新------------")]),s._v(" "),t("p",[s._v("更换显卡插槽后再度测试一下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nvidia-smi topo --matrix\n\tGPU0\tGPU1\tCPU Affinity\tNUMA Affinity\nGPU0\t X \tSYS\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-15,32-47\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nGPU1\tSYS\t X \t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("-31,48-63\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./p2pBandwidthLatencyTest\nBidirectional "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("P2P")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Enabled Bandwidth Matrix "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GB/s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   D"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("D     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("554.55")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.42")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.30")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("558.10")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("发现更换插槽后使用了不同组的 "),t("code",[s._v("cpu")]),s._v(" ，通信速度有所加快")]),s._v(" "),t("h4",{attrs:{id:"_3、-查看-nvlink-的状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、-查看-nvlink-的状态"}},[s._v("#")]),s._v(" 3、 查看 nvlink 的状态")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nvidia-smi nvlink --status\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("GPU "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": TITAN RTX "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UUID: GPU-486a9b0f-d80e-668e-fa93-cf5988109248"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t Link "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("inactive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\t Link "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("inactive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nGPU "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": TITAN RTX "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UUID: GPU-726723cc-04b1-d7a2-7638-0b73154449bc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t Link "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("inactive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\t Link "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("inactive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("处于 inactive 状态")]),s._v(" "),t("h4",{attrs:{id:"_4、安装-nccl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、安装-nccl"}},[s._v("#")]),s._v(" 4、安装 NCCL")]),s._v(" "),t("p",[s._v("kvstore")]),s._v(" "),t("p",[s._v("4.1 下载 NCCL")]),s._v(" "),t("ul",[t("li",[s._v("https://developer.nvidia.com/nccl")])]),s._v(" "),t("p",[s._v("4.2 安装 NCCL")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg -i nccl-local-repo-ubuntu1804-2.10.3-cuda10.2_1.0-1_amd64.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libnccl2 libnccl-dev\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h5",{attrs:{id:"_4-3-查看-nccl-安装情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-查看-nccl-安装情况"}},[s._v("#")]),s._v(" 4.3 查看 NCCL 安装情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dpkg -l"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nccl\n\nii  libnccl-dev                                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.10")]),s._v(".3-1+cuda10.2                                   amd64        NVIDIA Collective Communication Library "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NCCL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Development Files\nii  libnccl2                                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.10")]),s._v(".3-1+cuda10.2                                   amd64        NVIDIA Collective Communication Library "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NCCL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Runtime\nii  libvncclient1:amd64                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v(".11+dfsg-1ubuntu1.4                              amd64        API to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" one's own VNC server - client library\nii  nccl-local-repo-ubuntu1804-2.10.3-cuda10.2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("-1                                               amd64        nccl-local repository configuration files\nii  nccl-repo-ubuntu1804-2.7.8-ga-cuda10.2     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("-1                                                 amd64        nccl repository configuration files\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("接着测试通信带宽并无变化，看来不是 NCCL 的原因")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Bidirectional "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("P2P")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Enabled Bandwidth Matrix "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GB/s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   D"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("D     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("555.65")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.89")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.74")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("453.78")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_5、可能的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、可能的问题"}},[s._v("#")]),s._v(" 5、可能的问题")]),s._v(" "),t("p",[s._v("由于客观原因未排查出具体原因，列出可能的两点原因，希望对你有所帮助")]),s._v(" "),t("ul",[t("li",[s._v("温度太高：据参考资料[2]，温度在 85-90 度会到显卡的温度墙，会降频运行，解决方案可能是改装成水冷或者刀片式服务器，控制显卡温度")]),s._v(" "),t("li",[s._v("缺少 nvlink：根据 "),t("code",[s._v("nvidia-smi nvlink --status")]),s._v(" 得知，解决方案是购买显卡桥接器看是否能加大 GPU 间通信带宽")])]),s._v(" "),t("h4",{attrs:{id:"_6、根据参考资料-3-进行排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、根据参考资料-3-进行排查"}},[s._v("#")]),s._v(" 6、根据参考资料[3] 进行排查")]),s._v(" "),t("p",[s._v("------------2021/09/19更新------------")]),s._v(" "),t("p",[s._v("6.1 查看 nvlink 安装情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nvidia-smi topo -p2p n\n\n \tGPU0\tGPU1\t\n GPU0\tX\tNS\t\n GPU1\tNS\tX\t\n\nLegend:\n\n  X    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Self\n  OK   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Status Ok\n  CNS  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Chipset not supported\n  GNS  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GPU not supported\n  TNS  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Topology not supported\n  NS   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Not supported\n  U    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Unknown\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("显示结果为 "),t("code",[s._v("Not supported")])]),s._v(" "),t("p",[s._v("6.2 查看 P2P 通信情况")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/NVIDIA_CUDA-10.2_Samples/0_Simple/simpleP2P\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./simpleP2P\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("./simpleP2P"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" - Starting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nChecking "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" multiple GPUs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nCUDA-capable device count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\nChecking GPU"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" support of peer to peer memory access"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Peer access from TITAN RTX "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPU0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" TITAN RTX "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPU1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" No\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Peer access from TITAN RTX "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPU1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" TITAN RTX "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GPU0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" No\nTwo or "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" GPUs with Peer-to-Peer access capability are required "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ./simpleP2P.\nPeer to Peer access is not available amongst GPUs "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the system, waiving test.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("结果显示在不使用桥接器的情况下，双卡无法实现 P2P 通信")]),s._v(" "),t("p",[s._v("6.3 开启 TCC 计算模式")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nvidia-smi -i "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -dm TCC\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_6、参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、参考资料"}},[s._v("#")]),s._v(" 6、参考资料")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("[1] https://www.microway.com/hpc-tech-tips/nvidia-smi_control-your-gpus/")])]),s._v(" "),t("li",[t("p",[s._v("[2] https://bizon-tech.com/blog/bizon-z9000-8gpu-deeplearning-server-rtx2080ti-titan-benchamarks-review#:~:text=Idle%20temperature%3A%2040C%20Max%20load%20noise%20level%20%28deep,%28deep%20learning%29%3A%206X%20times%20lower%20%28150%20vs.%20900%29")])]),s._v(" "),t("li",[t("p",[s._v("[3] https://www.cnblogs.com/devilmaycry812839668/p/13264080.html")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);